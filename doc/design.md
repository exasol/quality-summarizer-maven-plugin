# Software Design Document (SDD) â€” Quality Summarizer Maven Plugin

## Introduction and Goals

The system is designed to work as a Maven Plugin. It reads the [JaCoCo](https://www.jacoco.org/) report XML file in the verification phase and writes the `metrics.json` file. The purpose of the system is to extract metrics from the project and provide them in a straightforward and easily extensible manner.

## Constraints

The system will be implemented in Java, as a [Maven](https://maven.apache.org/) plugin.

## Context and Scope

The system is a standalone plugin that interacts with the project's build system via Maven and the test coverage report generated by JaCoCo.

### Out-of-scope

The produced summary is a single file local to the build result directory. How that file is post-processed to ingest it into a central quality database is explicitly _outside the scope_ of this document.

In order to be picked up by the repository crawler, the file must be available as artifact in the CI build on GitHub. This is a separate step and there are existing GitHub actions to upload artifacts. The Maven plugin does not need to know or even should know that it is running inside a GitHub action.

## Solution Strategy

### The Minimum Viable Product

For the Minimum Viable Product (MVP), only the overall path coverage will be extracted from JaCoCo's report XML. This value will be written into a `metrics.json` file that can be easily extended in the future to include more metrics.

We also decided to take the metrics directly form the build instead of Sonar, which serves as a quality measurement aggregator in the beginning. This spares us the effort of authentication, storing credentials, dealing with network issues and will overall be faster. Once we reach the point where we need other metrics like Sonar ratings, we will need to revise that strategy. We are clear about that fact, but intentionally chose the option with the lowest complexity until we need more than the path coverage.

## Building Block View

### Maven Plugin
`dsn~maven-plugin~1`

The summarizer is a Maven plugin.

Rationale:

Maven is a well-established build tool and can both run locally and in CI builds.

Covers:

* `req~summarizer-must-run-in-a-local-maven-build~1`
* `req~summarizer-must-run-in-a-git-hub-ci-build~1`

Needs: impl, itest

### OS Compatibility
`dsn~os-compatibility~1`

The summarizer is written in Java to run under Linux.

Comment:

Note that we only test on Linux in order to safe resources. We assume Windows and MacOS compatibility, but until that is required in our CI builds, we are not investing time for verification.

Needs: impl, itest

## Runtime View

### Extraction

#### Executed During 'Verify' Phase
`dsn~executed-during-verify-phase~1`

The summarizer hooks into Maven's `verify` lifecycle phase.

Needs: impl

#### Extracting Code Coverage From JaCoCo Report
`dsn~extracting-code-coverage-from-ja-co-co-report~1`

The summarizer extracts the overall path coverage value from the JaCoCo XML report `target/site/jacoco/jacoco.xml`.

Covers:

* `req~extracting-code-coverage-from-ja-co-co-report~1`

Needs: impl, itest

### Output Generation

#### Metric Output File
`dsn~metric-output-file~1`

The summarizer writes the output into `target/metrics.json`

Covers:

* `req~summarization-output~1`

Needs: impl, itest


#### Writing Code Coverage Value
`dsn~writing-code-coverage-value~1`

The summarizer writes the overall path coverage value into the element `coverage` as float percentage (range 0 to 100).

Covers:

* `req~summarization-output~1`
* `req~extracting-code-coverage-from-ja-co-co-report~1`

Needs: impl, itest

## Deployment View

The system is deployed as a Maven plugin into the project's build lifecycle where it will execute during the verification phase.

## Cross-cutting Concepts

Future versions of the plugin can extend the `metrics.json` file to include additional metrics from the JaCoCo report or other sources.

## Architectural Decisions

The decision to implement the system as a Maven plugin stems from the desire to integrate the tool with the project's build lifecycle, making this process automatic and integral to the project building and verification process.

## Quality Scenarios

Tests must be fully automated. The Maven ecosystem provides a [test harness](https://maven.apache.org/plugin-developers/plugin-testing.html) that we will be using for that purpose.

### Allowed Execution Time
`qs~allowed-execution-time~1`

The following integration test must complete in half a second or less:

1. Start the Maven plugin
2. Extract metrics
3. Write output file

Covers:

* `qg~allowed-execution-time~1`

Needs: itest

### Failing Safely When Summarization Breaks
`qs~failing-safely-when-summarization-breaks~1`

An integration test proves that the Maven build continues when the metric extraction failed.

Covers:

* `qg~failing-safely-when-summarization-breaks~1`

Needs: impl, itest

## Risks and Technical Debts

One potential risk is that changes in JaCoCo's reporting might affect the plugin's ability to accurately parse and extract metrics.

## Glossary

Maven
: An open-source software project management and comprehension tool used primarily for Java projects. [Learn more](https://maven.apache.org/)

JaCoCo
: A free code coverage library for Java. [Learn more](https://www.jacoco.org/)